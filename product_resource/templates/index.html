{% extends "baseCopy.html" %}
    {% block style %}
        .col-md-10{
            position: relative;
            min-height: 1px;
            padding-right: 0px;
            padding-left: 40px;
            overflow-y: scroll;
            height:1130px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
         .col-md-10::-webkit-scrollbar {
            display: none; /* Chrome Safari */
        }
        input{
            padding-left:10px;
            margin-right:15px;
        }
    {% endblock %}


    {% block content %}
        <div class="el-col-md-12" style="height: 100px;background-color: #f5f5f5;margin: 10px 0px 10px 20px;">
            <!--导航-->
            <div class="menu">
                <ul class="breadcrumb">
                <li class="active">
                     <a href="{% url 'index' %}">首页</a>
                </li>
                <li>
                     <a href="{% url 'search'%}">检索</a>
                </li>
                <li class="disabled">
                     <a href="{% url 'analysis' %}">信息</a>
                </li>
            </ul>
            </div>
            <div class="filter" style="padding-left: 15px">
                <form action="{% url 'index' %}" method="get">
                   <input class="el-button--text" placeholder="产品名称" name="pname">
                   <input class="el-button--text" placeholder="CAS号" name="cas">
                   <select name="source" style="width: 142px;height: 24px">
                       <option value="">请选择</option>
                       {% for type in k_sources %}
                      <option value="{{type.source }}">{{type.source }}</option>
                      {% endfor %}
                    </select>
                   <button type="submit" class="el-btn btn-danger" style="border-radius: 5px"><i class="bi bi-search" style="font-size: 1rem; color: white;padding: 5px;"></i>搜索</button>
                </form>
            </div>
        </div>
        <div class="col-md-12 column">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>序号</th>
                <th>名称</th>
                <th>cas号</th>
                <th>纯度</th>
                <th>价格</th>
                <th>规格</th>
                <th>状态</th>
                <th>来源</th>
                <th>更新时间</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% for f in page %}
                <tr>
                    <td>{{forloop.counter }}</td>
                    <td>{{f.pname|slice:"20" }}</td>
                    <td class="cas{{ f.ID }}">{{f.cas }}</td>
                    <td>{{f.purity }}</td>
                    <td>{{f.price }}</td>
                    <td>{{f.specs }}</td>
                    <td>{{f.status }}</td>
                    <td class="source{{ f.ID }}">{{f.source }}</td>
                    <td>{{f.pickup_date}}</td>
                    <td><button type="button" class="btn-xs btn-info"><a href="{{ f.source_url}}" style="color: white;text-decoration: none" target="_blank" class="link{{ f.ID }}">详情</a></button>
                    <button type="button" class="btn-xs btn-warning" id="update{{ forloop.counter }}" onclick="update({{ f.ID }})" >更新</button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <span style="float: left">
    {% if page.has_previous %}
{#                //判断当前页是否有上一页#}
        <button class="btn btn-info btn-sm">

                <a href="/product/index.html?page={{page.previous_page_number}}&pname={{ name }}&cas={{ cas }}&source={{ source }}" aria-label="Previous"><span aria-hidden="true">上一页</span></a>

        </button>

    {% endif %}
</span>
    <div style="float: left;margin-left: 600px ">第{{ page.number }}页/共{{ page_nums }}页</div>
    <span style="float: right">
        {% if page.has_next %}
    {#                 // 判断当前页是否有下一页#}
             <button class="btn btn-info btn-sm">
             <a href="/product/index.html?page={{page.next_page_number}}&pname={{ name }}&cas={{ cas }}&source={{ source }}" aria-label="Next"><span aria-hidden="true">下一页</span></a>
             </button>

          {% endif %}
    </span>
    <h5 class="page-header"></h5>

    {% endblock %}

{% block script %}

    function update(o){
        list=[]
        item={}
        cas = $("td.cas"+o).text()
        console.log(cas)
        source = $("td.source"+o).text()
        console.log(source)
        link = $(".link"+o).attr('href')
        console.log(link)
        list.push(cas,source,link)
        $.post('/product/api/save_url_redis/',{"data":list.join(';')},function(data){
            alert('success')
            window.location.reload();
        })
    }


{% endblock %}
